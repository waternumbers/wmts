---
title: "Using wmts"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Using Dynamic TOPMODEL}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## test for GloFAS
```{r, setup}
library(wmts)
outdir <- tempfile()
dir.create(outdir)
```

The wmts package aims to provide a Web Map Tile Service (WMTS) written purely in R.
An overview of Web Map Tiles (aka Slippy Tiles) can be found on
[wikipedia](https://en.wikipedia.org/wiki/Tiled_web_map). As an outline the wmts package
broadly follows the de facto Google/OpenStreetMap format and naming
conventions.

The package contains function to 

- Generating WMTS tiles compliant with Google/OpenStreetMap format and naming
conventions from a raster data set.

- Generating an image to use as the scale for the tiles.

- Serve tiles generates from a raster time series as a set of tile layers with
dynamic tile generation, tile caching and data access methods.

## Tile Generation

```{r, set_file}
fn <- system.file("extdata","glofas.nc",package="wmts",mustWork=TRUE)
```

```{r, setup_fcol}
fcolour <- function(x){
  brk <- c(-Inf,0.000000e+00,2.656250e-01,2.453125e+00,2.239063e+05,Inf)
  crp <- colorRampPalette(c("lightblue", "blue"),alpha=TRUE)
  col <- c("#00000000",crp(length(brk)-2),NA)
  col[ cut(as.numeric(x),brk) ]
}

tmp <- scaleImage(fcolour, c(-Inf,0.000000e+00,2.656250e-01,2.453125e+00,2.239063e+05,Inf),1)

tmp <- singleTile(terra::rast(fn),fcolour,0,0,0)

## plotPalette(pal,file.path(outdir,"legend.svg"))
```

## tidy up
```{r, tidy_up}
unlink(outdir)
```

These capabilies are demonstrated later in this vignette.

## Serving Tiles and the OGC WMTS specification

The Open Geospatial Consortium (OGC) provide a full
[specification](https://www.ogc.org/standards/wmts) for a WMTS. This is
currently not fully implimented and the following gives a comparision of the
Tile Server within wmts (v0.0.0.9100) in comparison to the three request types
defined in the standard. Note that wmts supports only RESTful
requests, there is currently no support for KVP or SOAP request formats.

### GetCapabilities

Not supported. Manually generated responses could be served via the static
file end point `<base_url>/`. A json response containing the times of the data
is served on `base_url/times` format outit would be possible to serve this




It
is not as performant as serving static tiles or more vommeans to generate and serve Web Map Tiles (WMS)

